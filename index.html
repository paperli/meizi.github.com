<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="viewport" content="user-scalable=no, width=device-width">
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<title>MEIZI</title>
	<link rel="shortcut icon" href="images/favicon.ico" />
	<link rel="apple-touch-icon-precomposed" href="images/icon.png" />
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="images/icon72.png" />
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="images/icon114.png" />
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="images/icon144.png" />
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.0/jquery.mobile-1.3.0.min.css" />
	<link rel="stylesheet" href="style/meizi.css" />
	<link rel="stylesheet" href="style/style.css" />
	<script src="http://code.jquery.com/jquery-1.8.2.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.3.0/jquery.mobile-1.3.0.min.js"></script>
	<script src="src/jquery.easing.1.3.js"></script>
	<script src="src/QTransform.js"></script>
	<script src="src/StackBlur.js"></script>
	<script src="src/code.js"></script>
	
</head>	
	
<body>
	<div id="fb-root"></div>
	<script>
	  // Additional JS functions here
	  window.fbAsyncInit = function() {
	    FB.init({
	      appId      : '151684361518791', // App ID
	      channelUrl : 'channel.html', // Channel File
	      status     : true, // check login status
	      cookie     : true, // enable cookies to allow the server to access the session
	      xfbml      : true  // parse XFBML
	    });

	    // Additional init code here
		FB.getLoginStatus(function(response) {
		  if (response.status === 'connected') {
		    // connected
			console.log("connected to fb");
			//get personal info in fb and redirect to main flow
			getMeProfile();
			//$.mobile.changePage("#main");
		  } else if (response.status === 'not_authorized') {
		    // not_authorized
			console.log("not authorized in fb");
			$("div#fb_login").show();
			$("a#fb_login_btn").click(login);
			$.mobile.changePage("#login_entry");
			//login();
		  } else {
		    // not_logged_in
			console.log("not logged in fb");
			$("div#fb_login").show();
			$("a#fb_login_btn").click(login);
			$.mobile.changePage("#login_entry");
			//login();
		  }
		 });
	  };
	  
	  //var temp = {};
	  function getMeProfile(){
		//temp = {name:"..",pic:".."};
		FB.api('/me?fields=name,picture.width(160).height(160)', function(response) {
			me.name = response.name;
			me.pic = response.picture.data.url;
			$("#me_name").html(me.name);
			$("div#me_pic").css("background-image","url("+me.pic+")");
			//$("img#me_pic").attr("src",me.pic);
		  //alert('Your name is ' + response.name + '\nPic: '+response.picture.data.url);
		  $.mobile.changePage("#main");
  		});
		//return temp;
	  }
	  
	  function login() {
		  console.log("[2]running login");
	      FB.login(function(response) {
	          console.log("[2]running login 2");
			  if (response.authResponse) {
	              // connected
				  console.log("[2]connected to fb");
				  getMeProfile();
	          } else {
	              // cancelled
				  console.log("[2]cancelled login");
	          }
	      });
		  console.log("[2]running login 3");
	  }
	  
	  // Load the SDK Asynchronously
	  (function(d){
	     var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
	     if (d.getElementById(id)) {return;}
	     js = d.createElement('script'); js.id = id; js.async = true;
	     js.src = "//connect.facebook.net/en_US/all.js";
	     ref.parentNode.insertBefore(js, ref);
	   }(document));
	</script>
	
	<!-- Login Flow -->
	<div data-role="page" id="login_entry" data-theme="a" data-dom-cache="true">
		<div data-role="header" data-position="fixed">
			<h1>Meizi Breakfast</h1>
		</div>
		<div data-role="content">
			<div id="fb_login"><a id="fb_login_btn" href="#">FACEBOOK LOGIN</a></div>
		</div>
		<div data-role="footer" data-position="fixed"><a href="mailto:paper.li@gmail.com">@PAPER.LI</a></div>
	</div>
	
	<!-- Main Flow -->
	<div data-role="page" id="main" data-theme="a" data-dom-cache="true">
		<div data-role="panel" id="mypanel" data-display="push">
			<a href="#mypanel" data-role="button">Close</a>
		</div>
		
		<div data-role="header" data-position="fixed">
			<h1>Meizi Breakfast</h1>
		</div>
		
		<div data-role="content">
			
			<div class="ui-bar-a member_info">
				<canvas id="cover_canvas">Your Browser Sucks!</canvas>
				<div id="me_pic"></div>
				<h2 class="ui-li-heading" id="me_name">Old John</h2>
			</div>
			
			<ul data-role="listview" data-inset="false" class="bubbles" data-split-theme="a">
				<li><a href="#msg1" data-transition="slide"><img src="images/map_thumb.png" /><p>I'm around</p><h2>Meizi Sanchong</h2></a><a href="#purchase" data-rel="popup" data-transition="pop" data-position-to="window" class="action_btn">Purchase</a></li>
				<li><a href="#msg2">say something...</a></li>
				
			</ul>
			
			<div id="storage">
				<img class="resource" id="cover_img" src="images/cover.jpg" />
			</div>
			
			<div data-role="popup" id="purchase" data-theme="a" data-overlay-theme="a" class="ui-content" style="max-width:240px; padding-bottom:2em;">
			    <h3>Purchase Album?</h3>
			    <p>Your download will begin immediately on your mobile device when you purchase.</p>
			    <a href="index.html" data-role="button" data-rel="back" data-theme="b" data-icon="check" data-inline="true" data-mini="true">Buy: $10.99</a>
			    <a href="index.html" data-role="button" data-rel="back" data-inline="true" data-mini="true">Cancel</a>
			</div>
		</div>
	</div>
	
	<div data-role="page" id="msg1" data-add-back-btn="true" data-theme="a" data-dom-cache="true">
		<div data-role="header">
			<h1>1st SHOP</h1>
		</div>
		
		<div data-role="content">
			WE SERVE YOU THE BEST MORNING!
		</div>
		
		<div data-role="footer" data-position="fixed">OH YA!</div>
	</div>
	
	
	
</body>
</html>
